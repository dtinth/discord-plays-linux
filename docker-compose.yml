version: '3.8'
services:
  desktop:
    build:
      context: desktop
    environment:
      RESOLUTION: 1280x720
      USER: desktop
      DISPLAY: :1
    ports:
      - 127.0.0.1:6081:80
      - 127.0.0.1:5901:5900
      - 127.0.0.1:2138:2138
    security_opt:
      - seccomp:./desktop-config/chrome.json
    shm_size: 2g
    tmpfs: /tmp
    volumes:
      - ./agent:/opt/agent:ro
      - ./desktop-config/agent.conf:/etc/supervisor/conf.d/agent.conf
      - ./desktop-config/fonts:/home/desktop/.fonts:ro
      - ./desktop-config/xvfb.sh:/usr/local/bin/xvfb.sh:ro
      - ./desktop-config/default.pa:/home/desktop/.config/pulse/default.pa:ro
  discord:
    build:
      context: desktop
    environment:
      RESOLUTION: 1280x720
      USER: desktop
      DISPLAY: :1
    ports:
      - 127.0.0.1:6080:80
      - 127.0.0.1:5900:5900
    volumes:
      - discord_home:/home/desktop
      - ./discord-config/default.pa:/home/desktop/.config/pulse/default.pa:ro
    tmpfs: /tmp
    ipc: host
    privileged: true
volumes:
  discord_home:
